# L_System

## Introduction
L-systems, or Lindenmayer systems, are a type of formal grammar most famously used for modelling the growth patterns of plants, and are also applied in the generation of fractals and procedural content in computer graphics[1]. It is the idea of modelling biological systems using a type of formal grammar and parallel rewriting system. 
Basically, an L-system is composed of four components[2]:
An Alphabet, V, of symbols that can be used to make strings of characters. This alphabet in turn consists of symbols that are of two types: variables, which are symbols that can be replaced, and constants / terminals, which are symbols that cannot be replaced.
An initial Axiom string, ω, which is the starting string we begin construction from. It defines the initial state of the system.
A collection of Production Rules or Productions, P, that expand each symbol into some larger string of symbols. These rules allow us to recursively generate new symbol sequences.
A Mechanism for translating the generated strings into geometric structures. 
After understanding the concept of L System and how it works, we can build our code on top of that.

## Objective
The goal of this project is to demonstrate the utilization of L-systems (Lindenmayer Systems) for generating intricate fractal patterns, specifically in this case, trees. The basic functions include, reading a configuration file containing L System parameters, displaying the resulting L system and skipping the generations process using hotkeys, loading different configuration file using hotkeys, increasing or decreasing three basic parameters of L System via hotkeys. More advance function would be 3D, coloring and texture of the tree, leafs shapes, context sensitivity system and stochastic system. Therefore, these features make up our workflow. 
Meanwhile, keep the code neat and speed up the generation process.

## Features Implemented
I use Python to implement these features. In my opinion, using Unity to build an L System would take the advantage of its built-in graphical capabilities and game development features to visually represent and interact with the L-system. In this case, building a GUI for L System, adding hotkeys, 3D, adding textures are made easier.  However,  Python is such a powerful language that I want to learn more about its visual programming through this project. To be short, when building an L-system in Python, we have access to various libraries and tools specifically designed for graphics. Turtle, Pygame, or Matplotlib, all of these can assist in rendering and displaying the L-system. I mainly use Turtle to build the L System.
The feature I implemented includes:

1. L-System Generation: Using a set of rules and an axiom, the L-system generates sequences that describe the fractal structure. The generation process can be skipped through by clicking.  Model a - Model h are from the six examples given, and the other two models are from Paul Bourke's website[3]. The sequences generated by the L-system are interpreted as drawing instructions for the turtle graphics library, producing the final fractal image.

2. Interactive Parameters: Users can interactively adjust parameters like distance, angle, leaf size, and branch size to observe their impact on the fractal generation process.


3. Model Loading Using Hotkeys: The system enables the loading of various sets of rules and axioms, referred to as 'models', to generate different types of fractal trees. Users can easily reset the system and choose new models pressing 'r' key and 'space'. These models are stored in external .py files, allowing users to add new models simply by importing a new .py file without the need for extensive code modifications. This approach enables to load user-defined models and significantly enhances code reusability.


4. Stochastic L system: In stochastic L-systems, the application of rules is probabilistic. Each symbol may have multiple possible replacement rules, each with an associated probability. When a symbol is processed, one of its replacement rules is chosen based on these probabilities.The implementation of stochastic rules in code requires using a random number generator to decide which rule to apply. In my code,  stochastic_rules  is a dictionary where the keys are symbols, and the values are another dictionary with two lists: rules (the possible replacements for the symbol) and probabilities (the associated probabilities for each rule). The  random.choices() function is used to select one rule based on the provided probabilities.

5. Context-Sensitive Rules: In context-sensitive L-systems, the application of a rule depends not just on the current symbol, but also on the symbols surrounding it, i.e., its 'context'. This is unlike context-free L-systems, where the application of rules only depends on the current symbol.In my code,  context_sensitive_rules  is implemented by considering the symbols before and after the current symbol while processing the L-system sequence. I check if the character within its context matches any context sensitive rule first, if it does, it would be applied the rules.


6. Leaf shapes and color variation:
Leaf shapes and color variation can greatly enhance the visual appeal of generated fractal trees. I  implement this feature by assigning different colors and leaf shapes,  and using random function combined with Turtle to varify the each leaf in the drawing process.图片: https://uploader.shimo.im/f/2Nt6sL2pTozFYRMC.png?sm_xform=image%2Fcrop%2Cx_0%2Cy_0%2Cw_1172%2Ch_108&accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE3MDE2OTAyMzMsImZpbGVHVUlEIjoidlZBWE1KNzJCUEZRZFEzbSIsImlhdCI6MTcwMTY4OTkzMywiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo2ODM2MjM5MH0.xJ09Ly_l1og2eiYoIqXG09H_Wmd_VjvW9VA9J86q71k


## Data Classes and Other Structures
I employs several classes to organize its functionality:
LSystemGenerator: This class defines the L-system generator, initializes its axiom, rules, angle, distance, and iterations. The generate method develops the L-system sequence over time using deterministic, stochastic, and context-sensitive rules.
LSystemRenderer: This class is responsible for rendering the L-system sequence into a visual image using turtle graphics. It includes methods for drawing different leaf shapes and coloring.
ParameterManager: This class manages the parameters that influence the L-system generation and the rendering process, and provides methods for changing these parameters interactively.
LSystemController: This class serves as the controller, coordinating between the generator, renderer, and parameter manager. It also handles model loading, user inputs, and instructions display.
The main data structures used in the code are Python strings and lists to represent and manipulate the L-system sequence, and stacks to handle the branching and returning operations in the drawing process.

## Results
The application successfully generates fractal trees as per the defined L-system rules and models. The stochastic and context-sensitive rules introduce variations in the tree structure, enhancing the natural appearance of the trees. The adjustable parameters allow users to interactively explore the parameter space of the L-system, providing a deeper understanding of the L System generation process.

## Limitation
For my future improvements, this project has a few shortcomings:
1. The existing user interface is relatively rudimentary. Since Python itself is not good at designing the user interface, it requires the use of additional and more complex libraries, such as Pygame. This entails familiarizing oneself with new functionalities, debugging, and modifying a significant amount of existing code. Due to time constraints, implementing a graphical user interface (GUI) was not possible.
2. 3D visualization was not achieved. Within the Turtle library, implementing 3D visualization is challenging. I explored the possibility of using the OpenGL library, which supports 3D rendering. However, it would require considerable debugging and rewriting of code, which was not feasible given the time constraints. Perhaps this can be attempted in the future.

## Conclusion
This project showcases the power and versatility of L-systems as a tool for generating complex fractal patterns. By integrating deterministic, stochastic, and context-sensitive rules in the L-system, the application can produce a wide variety of L System trees that mimic the complexity of natural branching structures. The interactive controls further enhance the usefulness of the application as an educational tool for understanding fractal generation and L-systems. Future improvements could include the addition of more models, and further enhancements to the rendering process to increase the visual appeal of the generated fractals.

## Reference
[1] Przemysław Prusinkiewicz and Aristid Lindenmayer. (1990) The Algorithmic Beauty of Plants. Springer-Verlag
[2] Mundy Reimer. (2020). Generating a Garden with Python. Mundy Reimer. https://mundyreimer.github.io/blog/lindenmayer-grammars-1
[3] Paul Bourke.(1991). L-System User Notes. https://paulbourke.net/fractals/lsys/
[4] Houdini. (2020). L-System geometry node. Houdini. https://www.sidefx.com/docs/houdini/nodes/sop/lsystem.html#use-modeled-geometry-in-an-l-system
[5] Python Software Foundation.(2023). turtle — Turtle graphics. Python Documentation. https://docs.python.org/3.9/library/turtle.html

